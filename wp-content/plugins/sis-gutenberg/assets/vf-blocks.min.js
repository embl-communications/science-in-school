!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@wordpress/blocks"),require("react"),require("@wordpress/block-editor"),require("@wordpress/components"),require("@wordpress/data"),require("@wordpress/i18n"),require("@wordpress/hooks")):"function"==typeof define&&define.amd?define(["@wordpress/blocks","react","@wordpress/block-editor","@wordpress/components","@wordpress/data","@wordpress/i18n","@wordpress/hooks"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).wp.blocks,e.React,e.wp.blockEditor,e.wp.components,e.wp.data,e.wp.i18n,e.wp.hooks)}(this,(function(e,t,n,r,l,s,o){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=a(t);const c={renderPrefix:"",renderSuffix:"",postId:0,nonce:""};var u=wp.element.createElement(r.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},wp.element.createElement(r.Path,{d:"M19 7h-1V5h-4v2h-4V5H6v2H5c-1.1 0-2 .9-2 2v10h18V9c0-1.1-.9-2-2-2zm0 10H5V9h14v8z"}),wp.element.createElement(r.Path,{d:"M10.943 16c.522-1.854.972-3.726 1.386-5.58h-1.323a126.482 126.482 0 01-.918 4.383h-.081c-.342-1.44-.657-2.988-.936-4.428l-1.35.09c.414 1.854.873 3.681 1.395 5.535h1.827zm5.161-2.169H14.16V16h-1.332v-5.58h3.636v1.098H14.16v1.296h1.944v1.017z"}));const p=()=>({icon:u,keywords:[s.__("VF"),s.__("Visual Framework"),s.__("EMBL")],attributes:{ver:{type:"string"}},supports:{align:!1,className:!1,customClassName:!1,html:!1},edit:()=>null,save:()=>null}),m=p(),d={...m,name:"sis/info-box-column",title:s.__("Grid Column"),category:"vf/core",description:s.__("Visual Framework (core)"),parent:["sis/info-box","vf/embl-grid"],supports:{...m.supports,inserter:!1,lightBlockWrapper:!0},attributes:{...m.attributes,span:{type:"integer",default:1}}};function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}d.save=e=>{const{span:t}=e.attributes,r=[];Number.isInteger(t)&&t>1&&r.push(`vf-grid__col--span-${t}`);const l={};return r.length&&(l.className=r.join(" ")),wp.element.createElement("div",l,wp.element.createElement(n.InnerBlocks.Content,null))},d.edit=e=>{const{clientId:o}=e,{span:a}=e.attributes,{updateBlockAttributes:c}=l.useDispatch("core/block-editor"),{hasChildBlocks:u,hasSpanSupport:p,rootClientId:m}=l.useSelect((e=>{const{getBlockName:t,getBlockOrder:n,getBlockRootClientId:r}=e("core/block-editor"),l=r(o);return{rootClientId:l,hasChildBlocks:n(o).length>0,hasSpanSupport:"sis/info-box"===t(l)}}),[o]);t.useEffect((()=>{p||1===a||e.setAttributes({span:1})}),[o]);const d=t.useCallback((t=>{a!==t&&(e.setAttributes({span:t}),c(m,{dirty:Date.now()}))}),[a,o,m]),f={},w=[];return p&&Number.isInteger(a)&&a>1&&w.push(`vf-grid__col--span-${a}`),w.length&&(f.className=w.join(" ")),wp.element.createElement(i.default.Fragment,null,p&&wp.element.createElement(n.InspectorControls,null,wp.element.createElement(r.PanelBody,{title:s.__("Advanced Settings"),initialOpen:!0},wp.element.createElement(r.RangeControl,{label:s.__("Column span"),help:s.__("Columns may be merged to fit."),value:Number.isInteger(a)?a:1,onChange:d,allowReset:!0,step:1,min:1,max:6}))),wp.element.createElement(n.__experimentalBlock.div,f,wp.element.createElement(n.InnerBlocks,{templateLock:!1,renderAppender:u?void 0:()=>wp.element.createElement(n.InnerBlocks.ButtonBlockAppender,null)})))};const w=e=>{const{value:t,min:n,max:l,onChange:o}=e,a={label:s.__("Number of Columns"),className:"components-vf-control"};e.help&&(a.help=e.help);const i=e=>e+n===t;return wp.element.createElement(r.BaseControl,a,wp.element.createElement(r.ButtonGroup,{"aria-label":a.label},Array(l-n+1).fill().map(((e,t)=>wp.element.createElement(r.Button,{key:t,isPrimary:i(t),"aria-pressed":i(t),onClick:()=>o(t+n)},t+n)))))},g=(t,n,r,l)=>({type:"block",blocks:[t],isMatch:e=>1!==e.placeholder,transform:(t,s)=>{let o=s.map((e=>({attributes:{...e.attributes},innerBlocks:[...e.innerBlocks]})));for(;o.length<r;)o.push({});for(;o.length>l;){const e=o.pop();o[o.length-1].innerBlocks.push(...e.innerBlocks)}return e.createBlock(n,{columns:o.length},o.map((t=>e.createBlock("sis/info-box-column",t.attributes||{},t.innerBlocks||[]))))}}),h=p(),b={...h,name:"sis/info-box",title:s.__("SiS Info box"),category:"vf/core",description:s.__("Visual Framework (core)"),supports:{...h.supports,lightBlockWrapper:!0},attributes:{...h.attributes,placeholder:{type:"integer",default:0},columns:{type:"integer",default:0},dirty:{type:"integer",default:0}}};function v(e,t){var n,r;if(0===t.length)return e;for(n=0,r=t.length;n<r;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e<0?-2*e:e}function k(e,t,n,r){var l,s=v(v(v(e,n),(l=t,Object.prototype.toString.call(l))),typeof t);if(null===t)return v(s,"null");if(void 0===t)return v(s,"undefined");if("object"==typeof t||"function"==typeof t){if(-1!==r.indexOf(t))return v(s,"[Circular]"+n);r.push(t);var o=function(e,t,n){return Object.keys(t).sort().reduce((function(e,r){return k(e,t[r],r,n)}),e)}(s,t,r);if(!("valueOf"in t)||"function"!=typeof t.valueOf)return o;try{return v(o,String(t.valueOf()))}catch(e){return v(o,"[valueOf exception]"+(e.stack||e.message))}}return v(s,t.toString())}b.save=e=>{const{columns:t,placeholder:r}=e.attributes;if(1===r)return null;const l=`vf-grid | vf-grid__col-${t}`;return wp.element.createElement("div",{className:l},wp.element.createElement(n.InnerBlocks.Content,null))},b.edit=o=>{const{clientId:a}=o,{dirty:c,columns:u,placeholder:p}=o.attributes;t.useEffect((()=>{0===u&&o.setAttributes({placeholder:1})}),[a]);const{replaceInnerBlocks:m}=l.useDispatch("core/block-editor"),{setColumns:d,updateColumns:g}=l.useSelect((t=>{const{getBlocks:n,getBlockAttributes:r}=t("core/block-editor"),l=e=>{let t=0;return e.forEach((e=>{const{span:n}=e.attributes;Number.isInteger(n)&&n>0?t+=n:t++})),t},s=t=>{o.setAttributes({columns:t,placeholder:0});const r=n(a),s=l(r);t<s&&(e=>{let t=n(a),r=[];for(;t.length>1&&l(t)>e;)r=r.concat(t.pop().innerBlocks);m(t[t.length-1].clientId,r.concat(t[t.length-1].innerBlocks),!1),m(a,n(a).slice(0,t.length),!1)})(t),t>s&&(t=>{const r=n(a);for(;l(r)<t;)r.push(e.createBlock("sis/info-box-column",{},[]));m(a,r,!1)})(t)};return{setColumns:s,updateColumns:()=>{const{columns:e}=r(a);s(e),o.setAttributes({dirty:0})}}}),[a]);t.useEffect((()=>{c>0&&g()}),[c]);const h=e=>wp.element.createElement(w,f({value:u,min:1,max:6,onChange:t.useCallback((e=>d(e)))},e));if(1===p)return wp.element.createElement(n.__experimentalBlock.div,{className:"vf-block vf-block--placeholder"},wp.element.createElement(r.Placeholder,{label:s.__("VF Grid"),icon:"admin-generic"},wp.element.createElement(h,null)));const b=`vf-grid | vf-grid__col-${u}`,v={"--block-columns":u};return wp.element.createElement(i.default.Fragment,null,wp.element.createElement(n.InspectorControls,null,wp.element.createElement(r.PanelBody,{title:s.__("Advanced Settings"),initialOpen:!0},wp.element.createElement(h,{help:s.__("Content may be reorganised when columns are reduced.")}))),wp.element.createElement(n.__experimentalBlock.div,{className:b,style:v},wp.element.createElement(n.InnerBlocks,{allowedBlocks:["sis/info-box-column"],templateLock:"all"})))},b.transforms={from:[g("core/columns","sis/info-box",1,6),g("vf/embl-grid","sis/info-box",1,6)]};const _=e=>function(e,t){for(;e.length<t;)e="0"+e;return e}(k(0,e,"",[]).toString(16),8),y=p(),E={};var B={...y,name:"vf/plugin",title:s.__("Preview"),category:"vf/wp",description:"",attributes:{...y.attributes,ref:{type:"string"}},supports:{...y.supports,inserter:!1,reusable:!1},edit:(e=>{const n={fields:{}};return r=>{const{clientId:l}=r;return t.useEffect((()=>{o.hasAction("vf_plugin_acf_update","vf_plugin")||o.addAction("vf_plugin_acf_update","vf_plugin",(e=>{n.fields[e.name]=e.value,r.setAttributes({__acfUpdate:Date.now()})}))}),[l]),e({...r,transient:{...r.transient||{},...n}})}})((e=>{const[n]=t.useState(acf.uniqid("block_")),[l,s]=t.useState(!0),[o,a]=t.useState(!0),[i,c]=t.useState(""),[u,p]=t.useState(null),m=t.useRef(null),{clientId:d}=e,f=t.useCallback((e=>{const{id:t}=e.data;t&&t.includes(n)&&(clearTimeout(window[`${t}_onMessage`]),window[`${t}_onMessage`]=setTimeout((()=>{window.removeEventListener("message",f),a(!1)}),100))}),[d]);t.useEffect((()=>{a(!0),s(!0),window.removeEventListener("message",f),window.addEventListener("message",f);(async()=>{let t;const r={is_plugin:1,...e.transient.fields},l=_(r);if(E.hasOwnProperty(l))t=await new Promise((e=>setTimeout((()=>{e(E[l])}),1)));else{const s=await wp.ajax.post("acf/ajax/fetch-block",{query:{preview:!0},nonce:acf.get("nonce"),post_id:acf.get("post_id"),block:JSON.stringify({id:n,name:e.attributes.ref,data:r,align:"",mode:"preview"})});s&&s.preview&&(t=s.preview,E[l]=t)}if(t){const e=t.split(/<script[^>]*?>/)[0],n=t.match(/<script[^>]*?>(.*)<\/script>/ms);p(Array.isArray(n)?n[1]:null),c(e),s(!1)}})()}),[d,e.attributes.__acfUpdate]),t.useEffect((()=>{if(!l&&(m.current.innerHTML=i,u)){const e=document.createElement("script");e.type="text/javascript",e.innerHTML=u,m.current.appendChild(e)}}),[l]);const w={className:`vf-block ${e.className}`,"data-ver":e.attributes.ver,"data-name":e.name,"data-editing":!1,"data-loading":o,style:{}};o&&(w.style.minHeight="100px");const g={};return o&&(g.visibility="hidden"),wp.element.createElement("div",w,o&&wp.element.createElement(r.Spinner,null),wp.element.createElement("div",{ref:m,style:g,className:"vf-block__view"}))})),save:()=>null};
/**!
   * VF Gutenberg blocks
   */const{coreOptin:C}=(()=>{const e=window.vfGutenberg||{};for(let[t,n]of Object.entries(c))e.hasOwnProperty(t)||(e[t]=n);return e})();if(1===parseInt(C)){[d,b].forEach((t=>e.registerBlockType(t.name,t)))}e.registerBlockType("vf/plugin",B),window.addEventListener("message",(({data:e})=>{if(e!==Object(e)||!/^vfwp_/.test(e.id))return;const t=document.getElementById(e.id);t&&t.vfActive&&window.requestAnimationFrame((()=>{t.style.height=`${e.height}px`}))}))}));
